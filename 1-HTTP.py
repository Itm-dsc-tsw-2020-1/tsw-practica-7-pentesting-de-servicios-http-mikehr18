import os
import mysql.connector as mysql
import requests
from urllib.request import urlopen

direcciones=[]

def traerPag(direccion):
    url ='http://' +direccion +'/php_tiendita_login/index.html'
    print(url)
    peticion = requests.get(url)
    print("\nPetici贸n HTTP")
    print("\nSitio: "+ str(peticion.url))
    print("Codigo de operaci贸n: "+ str(peticion.status_code))
    if(str(peticion.status_code)==200):
        direcciones.append(direccion)
    print("Codigo del sitio: \n" + str(peticion.text))
    f = open (direccion+'.txt','w')
    f.write(str(peticion.text))
    f.close()



conexion = mysql.connect( 
    host='localhost',
    user= 'root',
    passwd='',
    db='nmap' )
    
cursor = conexion.cursor()
cursor.execute( "select ip from host where servicio = 'http';")
for ip in cursor.fetchall() :
      print (ip)
      host = str(ip[0])
      try:
        traerPag(host)
      except:
        print("No se pudo hacer la petici贸n a esta direcci贸n: "+host)
conexion.close()

